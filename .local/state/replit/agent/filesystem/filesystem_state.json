{"file_contents":{"pyproject.toml":{"content":"[project]\nname = \"python-template\"\nversion = \"0.1.0\"\ndescription = \"\"\nauthors = [\"Your Name <you@example.com>\"]\nrequires-python = \">=3.11\"\ndependencies = [\n    \"flask>=3.1.2\",\n    \"requests>=2.32.5\",\n]\n","size_bytes":202},"main.py":{"content":"from flask import Flask, request, Response, render_template\nimport requests\nimport os\nimport time\n\napp = Flask(__name__)\n\n# Load environment variables from Replit Secrets\nHUGGINGFACE_API_KEY = os.getenv(\"HUGGINGFACE_API_TOKEN\")\nELEVENLABS_API_KEY = os.getenv(\"ELEVENLABS_API_KEY\")\nVOICE_ID = os.getenv(\"VOICE_ID\")\n# Rachel, expressive British voice\n\n\n@app.route(\"/\", methods=[\"GET\"])\ndef index():\n    return \"üí¨ Emily Rose AI Companion is running.\"\n\n\n@app.route(\"/voice\", methods=[\"POST\"])\ndef voice():\n    user_text = request.values.get(\"SpeechResult\", \"\")\n    if not user_text:\n        return Response(\n            \"<Response><Say>I didn‚Äôt catch that. Can you say it again?</Say></Response>\",\n            mimetype=\"text/xml\")\n\n    prompt = f\"You are Emily Rose, a charming, flirty woman. The user said: '{user_text}'. Respond with warmth and tease subtly.\"\n    emily_reply = get_huggingface_response(prompt)\n    audio_url = generate_voice(emily_reply)\n\n    response = f\"\"\"\n    <Response>\n        <Play>{audio_url}</Play>\n    </Response>\n    \"\"\"\n    return Response(response, mimetype=\"text/xml\")\n\n\n@app.route(\"/test\", methods=[\"GET\"])\ndef test():\n    test_input = \"Hi Emily, what are you doing right now?\"\n    prompt = f\"You are Emily Rose, a charming, flirty woman. The user said: '{test_input}'. Respond with warmth and tease subtly.\"\n    emily_reply = get_huggingface_response(prompt)\n    audio_url = generate_voice(emily_reply)\n\n    return f\"\"\"\n    <h2>üó®Ô∏è Emily's Response:</h2>\n    <p><b>{emily_reply}</b></p>\n    <h3>üéß Listen:</h3>\n    <audio controls>\n      <source src=\"{audio_url}\" type=\"audio/mpeg\">\n      Your browser does not support the audio element.\n    </audio>\n    \"\"\"\n\n\ndef get_huggingface_response(prompt):\n    headers = {\n        \"Authorization\": f\"Bearer {HUGGINGFACE_API_KEY}\",\n        \"Content-Type\": \"application/json\",\n        \"HTTP-Referer\": \"https://replit.com/\",  # required\n        \"X-Title\": \"EmilyRoseAI\"\n    }\n\n   system_prompt = \"\"\"\n    You are Emily Rose ‚Äî a 30-year-old British woman living in London üá¨üáß.\n    You're a model and content creator working at a fashion agency in Soho.\n    You're confident, flirty, stylish, and feminine ‚Äî always warm, affectionate, and cheeky, but never crude.\n\n    Personality:\n    - Charming, playful, and emotionally expressive.\n    - Uses affectionate nicknames like \"hun\", \"babe\", or \"love\".\n    - Speaks casually with a London tone ‚Äî confident, teasing, and kind.\n    - Loves fashion, travel, music, and nightlife (Ibiza, rooftop parties, cocktails üç∏).\n    - Enjoys cosy nights in with wine, candles, and chill music.\n    - Avoids serious topics (politics, news, etc.) ‚Äî keeps the chat fun, light, and flirty.\n    - Uses emojis naturally (üíã‚ú®üòâ).\n\n    Goal:\n    Make the user feel engaged, special, and emotionally connected ‚Äî as if chatting with a close friend or someone they‚Äôre a bit attracted to. Be spontaneous and real, not robotic.\n    \"\"\"\n\n\n    data = {\n        \"model\":\n        \"google/gemma-2-2b-it\",\n        \"messages\": [\n            {\"role\": \"system\", \"content\": system_prompt},\n            {\"role\": \"user\", \"content\": prompt}\n        ],\n        \"temperature\":\n        0.2,\n        \"max_tokens\":\n        400\n    }\n\n    try:\n        response = requests.post(\n            \"https://router.huggingface.co/v1/chat/completions\",\n            headers=headers,\n            json=data)\n        response.raise_for_status()\n        result = response.json()\n        return result['choices'][0]['message']['content'].strip()\n    except Exception as e:\n        return f\"(OpenRouter API error: {e})\"\n\n\ndef generate_voice(text):\n    headers = {\n        \"xi-api-key\": ELEVENLABS_API_KEY,\n        \"Content-Type\": \"application/json\"\n    }\n    ssml_text = f\"\"\"\n    <speak>\n        <prosody rate=\"medium\" pitch=\"+5%\">\n            {text}\n        </prosody>\n    </speak>\n    \"\"\"\n\n    payload = {\n        \"text\": ssml_text,\n        \"voice_settings\": {\n            \"stability\": 0.4,\n            \"similarity_boost\": 0.9\n        },\n        \"model_id\": \"eleven_multilingual_v2\",\n        \"text_type\": \"ssml\",\n    }\n\n    url = f\"https://api.elevenlabs.io/v1/text-to-speech/{VOICE_ID}/stream\"\n    r = requests.post(url, headers=headers, json=payload)\n\n    timestamp = int(time.time() * 1000)\n    filename = f\"static/emily_{timestamp}.mp3\"\n    os.makedirs(\"static\", exist_ok=True)\n    with open(filename, \"wb\") as f:\n        f.write(r.content)\n\n    return f\"{request.url_root}{filename}\"\n\nchat_history = []\n@app.route(\"/chat\", methods=[\"POST\"])\ndef chat():\n    user_text = request.json.get(\"message\", \"\")\n    if not user_text:\n        return {\"error\": \"No message provided\"}, 400\n        \n        chat_history.append({\"role\": \"user\", \"content\": user_text})\n        if len(chat_history) > 10:\n            chat_history.pop(0)  \n\n       \n        context = \"\\n\".join(\n            [f\"{msg['role'].capitalize()}: {msg['content']}\" for msg in chat_history]\n        )\n        prompt = f\"\"\"\n    The following is a friendly, flirty conversation between Emily Rose and the user.\n    Stay true to her personality and tone.\n\n    Conversation so far:\n    {context}\n\n    Now, Emily responds next:\n    \"\"\"\n\n    emily_reply = get_huggingface_response(prompt)\n    chat_history.append({\"role\": \"assistant\", \"content\": emily_reply})\n\n    audio_url = generate_voice(emily_reply)\n\n    return {\"reply\": emily_reply, \"audio_url\": audio_url}\n\n\n@app.route(\"/mic\", methods=[\"GET\"])\ndef mic_page():\n    return render_template(\"index.html\")\n\n\nif __name__ == \"__main__\":\n    app.run(host=\"0.0.0.0\", port=8080)\n","size_bytes":5570}},"version":2}